<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Johannes Krietsch" />

<meta name="date" content="2018-03-29" />

<title>Wind data manipulation</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Wind data manipulation</h1>
<h4 class="author"><em>Johannes Krietsch</em></h4>
<h4 class="date"><em>2018-03-29</em></h4>



<p>This file describes how to make a particle flow animation using wind data.</p>
<p><strong>Summary</strong></p>
<ol style="list-style-type: decimal">
<li>Load wind data and create base map</li>
<li>Create particles</li>
<li>Create particle flow animation</li>
</ol>
<div id="load-packages-define-study-area-and-set-working-directory" class="section level2">
<h2>Load packages, define study area and set working directory</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Packages</span>
<span class="kw">sapply</span>(<span class="kw">c</span>(<span class="st">'magrittr'</span>, <span class="st">'data.table'</span>, <span class="st">'foreach'</span>, <span class="st">'windR'</span>, <span class="st">'raster'</span>, <span class="st">'foreach'</span>, <span class="st">'doParallel'</span>, <span class="st">'ggplot2'</span>, <span class="st">'stringr'</span>),
       <span class="cf">function</span>(x) <span class="kw">suppressPackageStartupMessages</span>(<span class="kw">require</span>(x , <span class="dt">character.only =</span> <span class="ot">TRUE</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>) ) )
<span class="co">#&gt;   magrittr data.table    foreach      windR     raster    foreach </span>
<span class="co">#&gt;       TRUE       TRUE       TRUE       TRUE       TRUE       TRUE </span>
<span class="co">#&gt; doParallel    ggplot2    stringr </span>
<span class="co">#&gt;       TRUE       TRUE       TRUE</span>

<span class="co"># Projection (polar Lambert azimuthal equal-area with longitude origin 156.65Â° W)</span>
PROJ   =<span class="st"> '+proj=laea +lat_0=90 +lon_0=-156.653428 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 '</span>

<span class="co"># Specify directory</span>
wd =<span class="st"> </span><span class="kw">tempdir</span>() <span class="co"># temporary in this case (choose yourself)</span></code></pre></div>
</div>
<div id="load-wind-data-and-create-base-map" class="section level2">
<h2>1. Load wind data and create base map</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># load wind data</span>
wind_data =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'ERA_Interrim'</span>, <span class="st">'ERA_Interrim_850mb_4_7_June_2014_10km.RDS'</span>, <span class="dt">package =</span> <span class="st">'windR'</span>)
wA =<span class="st"> </span><span class="kw">readRDS</span>(wind_data)

<span class="co"># get extent of the wind data, defining the extent of the map</span>
w1 =<span class="st"> </span>wA[datetime_ <span class="op">==</span><span class="st"> </span><span class="kw">unique</span>(wA<span class="op">$</span>datetime_[<span class="dv">1</span>])]
wp =<span class="st"> </span><span class="kw">SpatialPoints</span>(<span class="kw">cbind</span>(w1<span class="op">$</span>x, w1<span class="op">$</span>y), <span class="dt">proj4string =</span> <span class="kw">CRS</span>(PROJ))
datBdry =<span class="st"> </span><span class="kw">gEnvelope</span>(wp)

<span class="co"># load high resolution map of area and crop with data boundary</span>
map_data =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'Map'</span>, <span class="st">'Arctic_map.RDS'</span>, <span class="dt">package =</span> <span class="st">'windR'</span>)
arctic =<span class="st"> </span><span class="kw">readRDS</span>(map_data)

BRW =<span class="st"> </span>arctic <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gIntersection</span>(datBdry)

<span class="kw">plot</span>(arctic)
<span class="kw">plot</span>(BRW, <span class="dt">col =</span> <span class="st">'red'</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># example to get a simple map</span>
<span class="co"># library(maptools)</span>
<span class="co"># data(wrld_simpl)</span>
<span class="co"># wrld_c = crop(wrld_simpl, extent(-180, -120, 45, 90)) # crop broad area</span>
<span class="co"># wrld = spTransform(wrld_c, CRS(PROJ)) # change projection</span>
<span class="co"># BRW = wrld %&gt;% gIntersection(datBdry) # crop with border of the wind data</span>

<span class="co"># Create simple base map</span>
b  =<span class="st"> </span>datBdry <span class="op">%&gt;%</span><span class="st"> </span>fortify <span class="op">%&gt;%</span><span class="st"> </span>data.table
bb =<span class="st"> </span><span class="kw">gBuffer</span>(datBdry, <span class="dt">width =</span> <span class="dv">30000</span>) <span class="op">%&gt;%</span><span class="st"> </span>gEnvelope <span class="op">%&gt;%</span><span class="st"> </span>fortify <span class="op">%&gt;%</span><span class="st"> </span>data.table
wr =<span class="st"> </span>BRW <span class="op">%&gt;%</span><span class="st"> </span>fortify <span class="op">%&gt;%</span><span class="st"> </span>data.table

bm =
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(  <span class="dt">data =</span> bb, <span class="kw">aes</span>(long, lat), <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">colour =</span> <span class="dv">1</span>, <span class="dt">size =</span> .<span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(  <span class="dt">data =</span> b,  <span class="kw">aes</span>(long, lat), <span class="dt">fill =</span> <span class="st">'dodgerblue4'</span>, <span class="dt">colour =</span> <span class="dv">1</span>, <span class="dt">size =</span> .<span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(  <span class="dt">data =</span> wr, <span class="kw">aes</span>(long, lat, <span class="dt">group =</span> group), <span class="dt">fill   =</span> <span class="st">'steelblue4'</span> , <span class="dt">colour =</span> <span class="st">'white'</span>, <span class="dt">size =</span> .<span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span>ggsn<span class="op">::</span><span class="kw">scalebar</span>(<span class="dt">data =</span> b,  <span class="dt">dist =</span> <span class="dv">100</span>, <span class="dt">st.size =</span> <span class="dv">3</span> ,<span class="dt">height =</span> .<span class="dv">01</span>) <span class="op">+</span>
<span class="st">  </span>rangeMapper<span class="op">::</span><span class="kw">theme_rangemap</span>()

<span class="kw">print</span>(bm)</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="create-particles" class="section level2">
<h2>2. Create particles</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># define the temporal extent</span>
time_start =<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">as.Date</span>(<span class="st">'2014-06-04'</span>))
time_end   =<span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">as.Date</span>(<span class="st">'2014-06-07'</span>))
time_steps =<span class="st"> '30 mins'</span>

ts =<span class="st"> </span><span class="kw">seq</span>(time_start, time_end, time_steps)

t_ext =<span class="st"> </span>ts
t_max =<span class="st"> </span><span class="kw">max</span>(ts)

<span class="co"># define the spatial extent</span>
ext   =<span class="st"> </span><span class="kw">extent</span>(datBdry)
x_ext =<span class="st"> </span><span class="kw">seq</span>(ext[<span class="dv">1</span>], ext[<span class="dv">2</span>])
y_ext =<span class="st"> </span><span class="kw">seq</span>(ext[<span class="dv">3</span>], ext[<span class="dv">4</span>])


<span class="co"># wind data</span>
w =<span class="st"> </span>wA
<span class="kw">setkey</span>(w, datetime_)
w_datetime_  =<span class="st"> </span><span class="kw">unique</span>(w<span class="op">$</span>datetime_)       <span class="co"># get vector of available wind data</span>

<span class="co"># number of particles</span>
NP_PP =<span class="st"> </span><span class="dv">10</span>                                 <span class="co"># number of particles per picture created</span>
NP    =<span class="st"> </span>NP_PP <span class="op">*</span><span class="st"> </span><span class="kw">length</span>(ts)               <span class="co"># number of particles</span>
TL    =<span class="st"> </span><span class="dv">50</span>                               <span class="co"># number of points for each track</span>
NP<span class="op">*</span>TL                                    <span class="co"># number of rows expected (will be smaller because some particles leave the map)</span>


<span class="co"># loop to create random particles</span>
o =<span class="st"> </span><span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span>NP, <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">'data.table'</span>,<span class="st">'rgdal'</span>, <span class="st">'raster'</span>, <span class="st">'magrittr'</span>, <span class="st">'sp'</span>, <span class="st">'rgeos'</span>, <span class="st">'raster'</span>, <span class="st">'windR'</span>) ) <span class="op">%do%</span><span class="st"> </span>{

  <span class="kw">cat</span>(i, <span class="st">'_of_'</span>, NP, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="dt">file =</span> <span class="kw">paste0</span>(wd, <span class="st">'/ProcessBar.txt'</span>))

  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>TL){

    <span class="cf">if</span> (k <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {

      <span class="co"># random start date</span>
      rd =<span class="st"> </span><span class="kw">sample</span>(t_ext, <span class="dv">1</span>)

      tmp =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">particle_id  =</span> <span class="kw">rep</span>(i, TL),
                       <span class="dt">point_id     =</span> <span class="dv">1</span><span class="op">:</span>TL,
                       <span class="dt">datetime_    =</span> <span class="kw">seq</span>(rd, rd <span class="op">+</span><span class="st"> </span><span class="dv">1800</span> <span class="op">*</span><span class="st"> </span>(TL <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">by =</span> time_steps))

      <span class="kw">setkey</span>(tmp, point_id)
      tmp[, w_date <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">closestDatetime</span>(datetime_, w_datetime_), by =<span class="st"> </span>point_id]

      <span class="co"># random start point</span>
      <span class="kw">set</span>(tmp, 1L, <span class="st">'x'</span>, <span class="dt">value =</span> <span class="kw">sample</span>(x_ext, <span class="dv">1</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>))
      <span class="kw">set</span>(tmp, 1L, <span class="st">'y'</span>, <span class="dt">value =</span> <span class="kw">sample</span>(y_ext, <span class="dv">1</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>))

      tmp[<span class="dv">1</span>, <span class="kw">c</span>(<span class="st">'u'</span>, <span class="st">'v'</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">getWind</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">w =</span> w[<span class="kw">J</span>(w_date), <span class="dt">nomatch=</span>0L], PROJ)]

    } <span class="cf">else</span> {

      <span class="cf">if</span> (<span class="kw">is.na</span>(tmp[k<span class="op">-</span><span class="dv">1</span>, u]) <span class="op">|</span><span class="st"> </span>tmp[k, datetime_ <span class="op">&gt;</span><span class="st"> </span>t_max]) {

        tmp =<span class="st"> </span><span class="kw">na.omit</span>(tmp)

      } <span class="cf">else</span> {

        <span class="kw">set</span>(tmp, k , 5L, <span class="dt">value =</span> tmp[k<span class="op">-</span><span class="dv">1</span>, x] <span class="op">+</span><span class="st"> </span>tmp[k<span class="op">-</span><span class="dv">1</span>, u] <span class="op">*</span><span class="st"> </span><span class="dv">1800</span>)
        <span class="kw">set</span>(tmp, k , 6L, <span class="dt">value =</span> tmp[k<span class="op">-</span><span class="dv">1</span>, y] <span class="op">+</span><span class="st"> </span>tmp[k<span class="op">-</span><span class="dv">1</span>, v] <span class="op">*</span><span class="st"> </span><span class="dv">1800</span>)

        tmp[k, <span class="kw">c</span>(<span class="st">'u'</span>, <span class="st">'v'</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">getWind</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">w =</span> w[<span class="kw">J</span>(w_date), <span class="dt">nomatch=</span>0L], PROJ)]

      }
    }
  }

  tmp

}


ob =<span class="st"> </span><span class="kw">rbindlist</span>(o)

<span class="kw">saveRDS</span>(ob, <span class="kw">paste0</span>(wd, <span class="st">'/Wind_particles.RDS'</span>))</code></pre></div>
</div>
<div id="create-particle-flow-animation" class="section level2">
<h2>3. Create particle flow animation</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># load particles and calculate the wind speed</span>
particle_data =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">'Map'</span>, <span class="st">'Wind_particles.RDS'</span>, <span class="dt">package =</span> <span class="st">'windR'</span>)
ob =<span class="st"> </span><span class="kw">readRDS</span>(particle_data)
<span class="kw">setkey</span>(ob, datetime_)
ob[, w_speed <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">sqrt</span>(u<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>v<span class="op">^</span><span class="dv">2</span>)]

<span class="co"># Set time frame and path</span>
ts =<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">date =</span> <span class="kw">seq</span>(<span class="st">'2014-06-04'</span> <span class="op">%&gt;%</span><span class="st"> </span>as.Date <span class="op">%&gt;%</span><span class="st"> </span>as.POSIXct, <span class="st">'2014-06-07'</span> <span class="op">%&gt;%</span><span class="st"> </span>as.Date <span class="op">%&gt;%</span><span class="st"> </span>as.POSIXct, <span class="dt">by =</span> <span class="st">'30 mins'</span>) )
<span class="kw">setkey</span>(ts, date)
tmp_path =<span class="st"> </span>wd <span class="co"># change path</span>
ts[, path <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(tmp_path, <span class="st">'/'</span>, <span class="kw">str_pad</span>(<span class="dv">1</span><span class="op">:</span>.N, <span class="dv">4</span>, <span class="st">'left'</span>, <span class="dt">pad =</span> <span class="st">'0'</span>), <span class="st">'.png'</span>)   ]

<span class="co"># Wind speed color scale</span>
Ws_min =<span class="st"> </span><span class="dv">0</span>
Ws_max =<span class="st"> </span><span class="kw">max</span>(ob<span class="op">$</span>w_speed, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
col_Ws =<span class="st"> </span><span class="kw">c</span>(<span class="st">'gold'</span>, <span class="st">'springgreen3'</span>, <span class="st">'springgreen4'</span>)
col_WS_v  =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)



<span class="co"># register parallel computing</span>
<span class="co"># cl = 20 %&gt;% makePSOCKcluster; registerDoParallel(cl)</span>

<span class="co"># loop that creates pictures for the animation</span>
<span class="kw">foreach</span>(<span class="dt">i =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(ts), <span class="dt">.packages =</span> <span class="kw">c</span>(<span class="st">'scales'</span>, <span class="st">'ggplot2'</span>, <span class="st">'lubridate'</span>, <span class="st">'stringr'</span>, <span class="st">'data.table'</span>, <span class="st">'windR'</span>) ) <span class="op">%dopar%</span><span class="st"> </span>{

  <span class="kw">png</span>(<span class="dt">filename =</span> ts[i, path], <span class="dt">width =</span> <span class="dv">700</span>, <span class="dt">height =</span> <span class="dv">700</span>, <span class="dt">units =</span> <span class="st">&quot;px&quot;</span>, <span class="dt">pointsize =</span> <span class="dv">9</span>, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>)

  <span class="co"># add track for particles</span>
  tail     =<span class="st"> </span><span class="dv">20</span>           <span class="co"># lenght of the running tail</span>
  tmp_date =<span class="st"> </span>ts[i]<span class="op">$</span>date   <span class="co"># current date</span>

  <span class="co"># subset particles</span>
  tmp_date_sub =<span class="st"> </span><span class="kw">seq</span>(tmp_date  <span class="op">-</span><span class="st"> </span><span class="dv">1800</span> <span class="op">*</span><span class="st"> </span>tail, tmp_date, <span class="dt">by =</span> <span class="st">'30 mins'</span>)
  pi =<span class="st"> </span>ob[<span class="kw">J</span>(tmp_date_sub), nomatch=0L]

  <span class="cf">if</span> (<span class="kw">nrow</span>(pi) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) pi[, a <span class="op">:</span><span class="er">=</span><span class="st">  </span><span class="kw">alphaAlong</span>(datetime_, <span class="dt">head =</span> <span class="dv">70</span>, <span class="dt">skew =</span> <span class="op">-</span><span class="dv">2</span>), by =<span class="st"> </span>particle_id] <span class="co"># alpha</span>

  bm_w =<span class="st"> </span>bm <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_path</span>(<span class="dt">data =</span> pi, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">group =</span> particle_id, <span class="dt">color =</span> w_speed), <span class="dt">alpha =</span> pi<span class="op">$</span>a) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_gradientn</span>(<span class="dt">colours =</span> col_Ws, <span class="dt">values =</span> col_WS_v, <span class="dt">limits =</span> <span class="kw">c</span>(Ws_min, Ws_max), <span class="dt">name =</span> <span class="st">'Wind speed (m/s)'</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">annotate</span>(<span class="st">'text'</span>, <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="op">-</span><span class="dv">1730000</span>,
             <span class="dt">label =</span> <span class="kw">paste0</span>(<span class="st">'2014 '</span>, <span class="kw">format</span>(tmp_date, <span class="st">&quot;%B %d %H:00&quot;</span>)),
             <span class="dt">color =</span> <span class="st">'white'</span>, <span class="dt">size =</span> <span class="dv">8</span>, <span class="dt">fontface =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="co"># size = 5 normal resolution, 8 for high</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.direction =</span> <span class="st">'horizontal'</span>, <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.12</span>, <span class="fl">0.13</span>),
          <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">'bold'</span>, <span class="dt">color =</span> <span class="st">'white'</span>),
          <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">'bold'</span>, <span class="dt">color =</span> <span class="st">'white'</span>),
          <span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>), <span class="st">'cm'</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">colour =</span> <span class="kw">guide_colourbar</span>(<span class="dt">title.position =</span> <span class="st">'top'</span>, <span class="dt">title.hjust =</span> <span class="fl">0.5</span>, <span class="dt">barwidth =</span> <span class="dv">8</span>))


  <span class="kw">print</span>(bm_w)

  <span class="kw">dev.off</span>()

}


<span class="co"># close parallel clusters</span>
<span class="kw">stopCluster</span>(cl)
<span class="kw">registerDoSEQ</span>()


<span class="co"># merge png into animation using ffmpeg (or with a different programm)</span>

<span class="kw">setwd</span>(tmp_path)
<span class="kw">system</span>(<span class="st">&quot;ffmpeg -framerate 12 -pattern_type glob -i '*.png' -y -c:v libx264 -profile:v high -crf 1 -pix_fmt yuv420p WindParticleFlow_Barrow.mov&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()
<span class="co">#&gt; R version 3.4.3 (2017-11-30)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 16.10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS: /usr/lib/openblas-base/libblas.so.3</span>
<span class="co">#&gt; LAPACK: /usr/lib/libopenblasp-r0.2.18.so</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] grid      parallel  stats     graphics  grDevices utils     datasets </span>
<span class="co">#&gt; [8] methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] stringr_1.3.0       ggplot2_2.2.1       doParallel_1.0.11  </span>
<span class="co">#&gt;  [4] iterators_1.0.9     foreach_1.4.4       rgeos_0.3-26       </span>
<span class="co">#&gt;  [7] gdalUtils_2.0.1.7   rgdal_1.2-18        windR_0.0.9        </span>
<span class="co">#&gt; [10] raster_2.6-7        sp_1.2-7            testthat_2.0.0     </span>
<span class="co">#&gt; [13] data.table_1.10.4-3 magrittr_1.5       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_0.12.16       lattice_0.20-35    png_0.1-7         </span>
<span class="co">#&gt;  [4] class_7.3-14       assertthat_0.2.0   rprojroot_1.3-2   </span>
<span class="co">#&gt;  [7] digest_0.6.12      R6_2.2.2           plyr_1.8.4        </span>
<span class="co">#&gt; [10] backports_1.1.2    RSQLite_2.0        evaluate_0.10.1   </span>
<span class="co">#&gt; [13] e1071_1.6-8        pillar_1.2.1       rlang_0.2.0       </span>
<span class="co">#&gt; [16] lazyeval_0.2.1     rstudioapi_0.7     praise_1.0.0      </span>
<span class="co">#&gt; [19] blob_1.1.1         R.utils_2.6.0      R.oo_1.21.0       </span>
<span class="co">#&gt; [22] reticulate_1.6     rmarkdown_1.9      labeling_0.3      </span>
<span class="co">#&gt; [25] devtools_1.13.5    foreign_0.8-69     bit_1.1-12        </span>
<span class="co">#&gt; [28] munsell_0.4.3      compiler_3.4.3     htmltools_0.3.6   </span>
<span class="co">#&gt; [31] gridExtra_2.3      tibble_1.4.2       roxygen2_6.0.1    </span>
<span class="co">#&gt; [34] codetools_0.2-15   crayon_1.3.4       withr_2.1.2       </span>
<span class="co">#&gt; [37] R.methodsS3_1.7.1  commonmark_1.4     jsonlite_1.5      </span>
<span class="co">#&gt; [40] gtable_0.2.0       DBI_0.8            scales_0.5.0      </span>
<span class="co">#&gt; [43] ncdf4_1.16         cli_1.0.0          stringi_1.1.7     </span>
<span class="co">#&gt; [46] ggsn_0.4.0         xml2_1.2.0         RColorBrewer_1.1-2</span>
<span class="co">#&gt; [49] tools_3.4.3        bit64_0.9-7        yaml_2.1.18       </span>
<span class="co">#&gt; [52] colorspace_1.3-2   rangeMapper_0.3-1  maptools_0.9-2    </span>
<span class="co">#&gt; [55] classInt_0.1-24    memoise_1.1.0      knitr_1.20</span></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
